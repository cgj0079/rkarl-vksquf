<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê°ê¸° ì§„ë‹¨ ë° ì²˜ë°© ì‹œë®¬ë ˆì´í„°</title>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      background: linear-gradient(120deg, #c2e9fb, #a1c4fd);
      color: #222;
      text-align: center;
      padding: 40px;
    }
    h1 { color: #004d99; }
    input, textarea, button {
      margin: 10px;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #bbb;
    }
    #result {
      margin-top: 30px;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: inline-block;
      text-align: left;
      width: 360px;
    }
    #sensor-panel {
      position: fixed;
      top: 20px;
      left: 20px;
      background: rgba(255,255,255,0.95);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      width: 200px;
      text-align: left;
    }
    #camera-icon {
      cursor: pointer;
      font-size: 24px;
      display: inline-block;
      margin-top: 10px;
    }
    #camera-stream {
      display: none;
      margin-top: 10px;
      width: 180px;
      height: 135px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <!-- ì„¼ì„œ íŒ¨ë„ -->
  <div id="sensor-panel">
    <strong>ì„¼ì„œ ì¸¡ì •</strong><br>
    ì²´ì˜¨: <input type="number" id="temp" step="0.1" value="36.5"><br>
    ì‹¬ë°•ìˆ˜: <input type="number" id="hr" placeholder="ì‹¬ë°•ìˆ˜ ì¸¡ì •" value="90">< br>
    <button onclick="readSensors()">ì„¼ì„œì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button><br>
    <div id="camera-icon" onclick="toggleCamera()">ğŸ“· ì¹´ë©”ë¼ ë³´ê¸°</div>
    <video id="camera-stream" autoplay></video>
  </div>

  <h1>ê°ê¸° ì§„ë‹¨ ë° ì²˜ë°© ì‹œë®¬ë ˆì´í„°</h1>
  <p>ì¦ìƒì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê¸°ì¹¨, ë‘í†µ ë“±)</p>
  <textarea id="symptoms" rows="3" cols="40" placeholder="ì¦ìƒì„ ì…ë ¥í•˜ì„¸ìš”"></textarea><br>
  <button onclick="diagnose()">ì§„ë‹¨ ë° ì²˜ë°©</button>
  <div id="result"></div>

  <script>
    // ì„¼ì„œ ì½ê¸°
    async function readSensors() {
      try {
        const res = await fetch('http://raspberrypi.local:5000/sensors'); // JSON ì˜ˆ: {temperature:37.2, heartRate:72}
        const data = await res.json();
        document.getElementById('temp').value = data.temperature.toFixed(1);
        document.getElementById('hr').value = data.heartRate;
        alert(`ì„¼ì„œ ì¸¡ì • ì™„ë£Œ: ì²´ì˜¨ ${data.temperature.toFixed(1)}â„ƒ, ì‹¬ë°•ìˆ˜ ${data.heartRate} bpm`);
      } catch(e) {
        alert("ì„¼ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      }
    }

    // ì¹´ë©”ë¼ í† ê¸€
    let cameraActive = false;
    let cameraStream = null;
    function toggleCamera() {
      const cam = document.getElementById('camera-stream');
      if (!cameraActive) {
        navigator.mediaDevices.getUserMedia({ video: true })
          .then(stream => {
            cam.srcObject = stream;
            cam.style.display = "block";
            cameraStream = stream;
            cameraActive = true;
          })
          .catch(err => { alert("ì¹´ë©”ë¼ ì ‘ê·¼ì´ ë¶ˆê°€í•©ë‹ˆë‹¤."); });
      } else {
        cameraStream.getTracks().forEach(track => track.stop());
        cam.style.display = "none";
        cameraActive = false;
      }
    }

    // ì§„ë‹¨ ë° ì²˜ë°©
    function diagnose() {
      const sym = document.getElementById('symptoms').value.toLowerCase();
      const temp = parseFloat(document.getElementById('temp').value) || 36.5;
      const resDiv = document.getElementById('result');

      if (!sym.trim() && isNaN(temp)) {
        resDiv.innerHTML = "âš ï¸ ì¦ìƒì´ë‚˜ ì²´ì˜¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        return;
      }

      let fever = temp >= 37.5;
      let result = "<h2>ì§„ë‹¨ ê²°ê³¼</h2>";

      const hasCough = /(ê¸°ì¹¨|ê¸°ì¹¨ì´ ë‚˜|ê¸°ì¹¨ë‚˜)/.test(sym);
      const hasSore = /(ì¸í›„í†µ|ëª©ì´ ì•„í”„|ëª© ì•„íŒŒ|ëª©ì´ ë”°ê°‘|ëª© ë”°ê°‘)/.test(sym);
      const hasNose = /(ì½§ë¬¼|ì½”ë§‰í˜|ì½”ê°€ ë§‰|ì½” ë§‰)/.test(sym);
      const hasBody = /(ëª¸ì‚´|ê·¼ìœ¡í†µ|ëª¸ì´ ì•„í”„|ê·¼ìœ¡ì´ ì•„í”„|ëª¸ ì•„íŒŒ|ê·¼ìœ¡ ì•„íŒŒ)/.test(sym);
      const hasHeadache = /(ë‘í†µ|ë¨¸ë¦¬ê°€ ì•„í”„|ë¨¸ë¦¬ ì•„íŒŒ)/.test(sym);

      const count = [hasCough, hasSore, hasNose, hasBody, hasHeadache, fever].filter(x=>x).length;

      if (count === 0) {
        result += "ğŸ˜Š ê°ê¸° ì¦ìƒì´ ëšœë ·í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>ì¶©ë¶„í•œ íœ´ì‹ê³¼ ìˆ˜ë¶„ ì„­ì·¨ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.";
        resDiv.innerHTML = result;
        return;
      }

      result += "ğŸ©º ê°ê¸° ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.<br><br><strong>ì„ì‹œ ì²˜ë°© ë‚´ìš©</strong><br><br>";
      if (fever) result += "ğŸŒ¡ï¸ í•´ì—´ì œ: ì•„ì„¸íŠ¸ì•„ë¯¸ë…¸íœ 500mg â€” 1ì •ì”©, 1ì¼ 3íšŒ (ì‹í›„)<br>";
      if (hasCough) result += "ğŸ’¨ ê¸°ì¹¨ì•½: ë±ìŠ¤íŠ¸ë¡œë©”í† ë¥´íŒ 10mL â€” 1ì¼ 3íšŒ<br>";
      if (hasNose) result += "ğŸ¤§ ë¹„ì¶©í˜ˆ ì™„í™”ì œ: ìŠˆë„ì—í˜ë“œë¦° 1ì • â€” 1ì¼ 2íšŒ<br>";
      if (hasSore) result += "ğŸ—£ï¸ ì¸í›„í†µ ì™„í™”ì œ: íŠ¸ë¼ìŠ¤íŠ¸ ëª©ìº”ë”” ë˜ëŠ” ì¸í›„ìŠ¤í”„ë ˆì´ â€” í•„ìš” ì‹œ 1íšŒ<br>";
      if (hasBody) result += "ğŸ’Š ê·¼ìœ¡í†µ ì™„í™”ì œ: ì´ë¶€í”„ë¡œíœ 200mg â€” 1ì •ì”©, 1ì¼ 3íšŒ<br>";
      if (hasHeadache) result += "ğŸ§  ë‘í†µ ì™„í™”ì œ: ì•„ì„¸íŠ¸ì•„ë¯¸ë…¸íœ ë³‘ìš©<br>";

      result += "<br><strong>ë³µìš© ì‹œ ì£¼ì˜ì‚¬í•­:</strong><br>- 8ì‹œê°„ ê°„ê²© ìœ ì§€<br>- 3ì¼ ì´ìƒ ì§€ì† ì‹œ ë³‘ì› ë°©ë¬¸<br>- ìˆ˜ë¶„ ì„­ì·¨ ë° íœ´ì‹";

      resDiv.innerHTML = result;
    }
  </script>
</body>
</html>
