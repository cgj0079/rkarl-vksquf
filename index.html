<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ê°ê¸° ìê°€ ì§„ë‹¨ ë° ì²˜ë°© ì‹œë®¬ë ˆì´í„°</title>
  <style>
    body {
      font-family: 'Pretendard', sans-serif;
      background: linear-gradient(120deg, #c2e9fb, #a1c4fd);
      color: #222;
      text-align: center;
      padding: 40px;
    }
    h1 { color: #004d99; }
    input, textarea, button {
      margin: 10px;
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #bbb;
    }
    #result {
      margin-top: 30px;
      padding: 20px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: inline-block;
      text-align: left;
      width: 360px;
    }
  </style>
</head>
<body>
  <h1>ê°ê¸° ì§„ë‹¨ ë° ì²˜ë°© ì‹œë®¬ë ˆì´í„°</h1>
  <p>ì¦ìƒì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê¸°ì¹¨, ì½§ë¬¼, ì¸í›„í†µ, ê·¼ìœ¡í†µ ë“±)</p>
  <textarea id="symptoms" rows="3" cols="40" placeholder="ì¦ìƒì„ ì…ë ¥í•˜ì„¸ìš”"></textarea><br>
  
  <p>ì²´ì˜¨ ì…ë ¥ (ë˜ëŠ” ë¼ì¦ˆë² ë¦¬íŒŒì´ ì„¼ì„œ ìë™ ì¸¡ì •)</p>
  <input type="number" id="temp" step="0.1" placeholder="ì˜ˆ: 37.8">
  <button onclick="readSensor()">ì„¼ì„œì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°</button><br><br>

  <button onclick="diagnose()">ì§„ë‹¨ ë° ì²˜ë°©</button>

  <div id="result"></div>

  <script>
    async function readSensor() {
      try {
        const res = await fetch('http://raspberrypi.local:5000/temperature');
        const data = await res.json();
        document.getElementById('temp').value = data.temperature.toFixed(1);
        alert(`ì„¼ì„œì—ì„œ ì²´ì˜¨ ${data.temperature.toFixed(1)}â„ƒë¥¼ ì½ì—ˆìŠµë‹ˆë‹¤`);
      } catch (e) {
        alert("ì„¼ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      }
    }

    function diagnose() {
      const sym = document.getElementById('symptoms').value.toLowerCase();
      const temp = parseFloat(document.getElementById('temp').value);
      const resDiv = document.getElementById('result');

      if (!sym.trim() && isNaN(temp)) {
        resDiv.innerHTML = "âš ï¸ ì¦ìƒì´ë‚˜ ì²´ì˜¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        return;
      }

      let fever = temp >= 37.5;
      let result = "<h2>ì§„ë‹¨ ê²°ê³¼</h2>";

      // ì¦ìƒ ê¸°ë°˜ ë¶„ì„
      let hasCough = sym.includes("ê¸°ì¹¨");
      let hasSore = sym.includes("ì¸í›„í†µ") || sym.includes("ëª©");
      let hasNose = sym.includes("ì½§ë¬¼") || sym.includes("ì½”ë§‰í˜");
      let hasBody = sym.includes("ëª¸ì‚´") || sym.includes("ê·¼ìœ¡í†µ");
      let hasHeadache = sym.includes("ë‘í†µ");

      let count = [hasCough, hasSore, hasNose, hasBody, hasHeadache, fever].filter(x=>x).length;
      if (count === 0) {
        result += "ğŸ˜Š ê°ê¸° ì¦ìƒì´ ëšœë ·í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>ì¶©ë¶„í•œ íœ´ì‹ê³¼ ìˆ˜ë¶„ ì„­ì·¨ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.";
        resDiv.innerHTML = result;
        return;
      }

      result += "ğŸ©º ê°ê¸° ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤.<br><br><strong>ì„ì‹œ ì²˜ë°© ë‚´ìš©</strong><br><br>";

      // ì²˜ë°© ì‹œë®¬ë ˆì´ì…˜
      if (fever) {
        result += "ğŸŒ¡ï¸ í•´ì—´ì œ: ì•„ì„¸íŠ¸ì•„ë¯¸ë…¸íœ(íƒ€ì´ë ˆë†€ì • 500mg) â€” 1ì •ì”©, 1ì¼ 3íšŒ (ì‹í›„ 30ë¶„)<br>";
      }
      if (hasCough) {
        result += "ğŸ’¨ ê¸°ì¹¨ì•½: ë±ìŠ¤íŠ¸ë¡œë©”í† ë¥´íŒ(ë²¤í¬ë“œì‹œëŸ½) â€” 10mLì”©, 1ì¼ 3íšŒ<br>";
      }
      if (hasNose) {
        result += "ğŸ¤§ ë¹„ì¶©í˜ˆ ì™„í™”ì œ: ìŠˆë„ì—í˜ë“œë¦°(í˜ë‹ˆë¼ë¯¼ì •) â€” 1ì •ì”©, 1ì¼ 2íšŒ<br>";
      }
      if (hasSore) {
        result += "ğŸ—£ï¸ ì¸í›„í†µ ì™„í™”ì œ: íŠ¸ë¼ìŠ¤íŠ¸ ëª©ìº”ë”” ë˜ëŠ” ì¸í›„ìŠ¤í”„ë ˆì´ â€” í•„ìš” ì‹œ 1íšŒ ì‚¬ìš©<br>";
      }
      if (hasBody) {
        result += "ğŸ’Š ê·¼ìœ¡í†µ ì™„í™”ì œ: ì´ë¶€í”„ë¡œíœ(ì´ë¶€íœì • 200mg) â€” 1ì •ì”©, 1ì¼ 3íšŒ<br>";
      }
      if (hasHeadache) {
        result += "ğŸ§  ë‘í†µ ì™„í™”ì œ: ì•„ì„¸íŠ¸ì•„ë¯¸ë…¸íœ ë³‘ìš© â€” ìœ„ í•´ì—´ì œì™€ ë™ì¼<br>";
      }

      result += "<br><strong>ë³µìš© ì‹œ ì£¼ì˜ì‚¬í•­:</strong><br>";
      result += "- 8ì‹œê°„ ê°„ê²© ìœ ì§€ ë° ê³¼ëŸ‰ ë³µìš© ê¸ˆì§€<br>";
      result += "- 3ì¼ ì´ìƒ ì§€ì† ì‹œ ë³‘ì› ë°©ë¬¸<br>";
      result += "- ìˆ˜ë¶„ì„ ì¶©ë¶„íˆ ì„­ì·¨í•˜ê³  ë”°ëœ»í•œ íœ´ì‹ í•„ìš”<br>";

      resDiv.innerHTML = result;
    }
  </script>
</body>
</html>
